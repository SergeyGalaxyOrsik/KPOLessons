### Буфер клавиатурного ввода
![[буфер_клавиатурного ввода.png]]
**Функции посимвольного ввода:**
- 01h
- 06h
- 07h
- 08h

**Для обычных клавиш(символьных):**
- при первом вызове возвращают код символа (не 0)
**Для расширенных клавиш:**
- при первом вызове возвращают 0
- при втором вызове возвращают расширенный код клавиши

Если клавиатурный буфер непустой, сразу возвращают управление вызывающей программе
Если клавиатурный буфер пуст, ожидают нажатия клавиши

### Очистка клавиатурного буфера
- Чтобы гарантировать, что программа будет ожидать нажатие клавиши, необходимо перед началом ожидания очистить
	- Для этого используется функция `0cH`

### Переходы

`jmp` – безусловный переход
- Единственный операнд – адрес, с которого нужно продолжить выполнение программы

```FASM
...
	mov    cx, 0
	jmp    MyLabel
	inc    cx
MyLabel:
    mov    ax, cx
```

`jcc` – условный переход (семейство инструкций)

| ja  | jb  | je  |
| --- | --- | --- |
| je  | jg  | jl  |
| jo  | jp  | js  |
| jz  | jae | jbe |
| jge | jle |     |

### Регистр флагов

Инструкции, которые вычисляют результат, изменяют биты регистра флагов в зависимости от полученного значения

Инструкции условного перехода работают в зависимости от состояния тех или иных флагов

**Вывод:**
- Перед выполнением перехода(условного) необходимо сделать так, чтобы условие перехода было отражено в одном из флагов 

### Инструкции условного перехода
- Проверяют значение флагов (в зависимости от состояния тех или иных инструкций)
- Если соответствующее условие выполняется – перейти по адресу, заданному операндом
- В противном случае – продолжить выполнение со следующей инструкции

### Изменение флагов

- `cmp` (эквивалент sub)
	- не записывает результат
- `test` (эквивалент and)
	- не записывает результат
инструкции, которые не записывают результат, в общем случае работают быстрее

### Локальные метки
**Метка,** имя которой начинается с точки, считается локальной

```FASM
...
DoSMTH:
	mov    cx, 15
.LocalLabel ; можно воспринимать как DoSMTH.LocalLabel
	mov    dx, 30
	...
	jnz    .LocalLabel
```

### Анонимные метки:
Метка с именем `@@` называется анонимной

```FASM
	jnz    @F ;<----- соответсвует ближайшей анонимной метке впереди по коду
	mov    cx, 20
@@:
	mov    dx,40
	..
	jae    @B ;<----- соответсвует ближайшей анонимной метке позади кода
```


### Как реализовать цикл

**Соглашение вызова** – набор правил, определяющих: 
- способ передачи параметров в функцию
- способ возврата значения функцией
- правила использования регистров
- правила удаления параметров со стека
- и т.д.

В регистре `AH` помещается номер функции MS-DOS
- параметры передаются в соответсвии с описанием функции, через регистры (тогда частично)
- вызов производится через `int 21h`
- результат, если есть, возвращается в соответсвии с описанием функции
- значения регистров общего назначения остаётся неизменным, кроме:
	- регистра AX
	- регистров, которые используются функцией для возврата результатов

### Инструкция LOOP
- Используется для реализации циклов
- Единственный операнд – адрес, куда надо перейти (по условию)
- принцип работы:
	- cx <--- cx-1 
	- Если cx != 0, выполнить переход
- по сути делает тоже самое, что и код

```FASM
SomeLabel:
	dec    cx
	jnx    SomeLabel
```

НО!
1) LOOP не изменяет флаги
2) Всегда работает с СУ